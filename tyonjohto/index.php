<?php

require "../vendor/config.php";
include('tyonjohto-header.php');

?>
<header style="padding: 15px 0; background: #343549;">
  <svg width="318" height="92" viewBox="0 0 318 92" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin: 10px auto;display: block; text-align:center;">
    <rect x="151" y="17" width="167" height="75" rx="15" fill="#F8981E"/>
    <path d="M1.59233 38.4773V29.0909H38.8864V38.4773H25.9801V72H14.4986V38.4773H1.59233ZM46.7904 84.0682C45.4635 84.0682 44.1994 83.9634 42.9981 83.7539C41.7969 83.5584 40.7423 83.286 39.8344 82.9368L42.3486 74.7237C43.2984 75.0589 44.1644 75.2754 44.9466 75.3732C45.7428 75.471 46.4202 75.4151 46.979 75.2056C47.5516 74.9961 47.9637 74.598 48.2151 74.0114L48.4665 73.4247L37.1526 39.8182H49.2208L54.4168 62.1108H54.752L60.0319 39.8182H72.1839L60.4509 74.6818C59.8643 76.4557 59.0122 78.0481 57.8948 79.4588C56.7913 80.8835 55.3387 82.0079 53.5368 82.832C51.735 83.6561 49.4862 84.0682 46.7904 84.0682ZM89.998 72.5866C86.5061 72.5866 83.517 71.8952 81.0307 70.5124C78.5444 69.1156 76.6378 67.1741 75.3109 64.6879C73.984 62.1876 73.3205 59.2893 73.3205 55.9929C73.3205 52.6965 73.984 49.8052 75.3109 47.3189C76.6378 44.8187 78.5444 42.8771 81.0307 41.4943C83.517 40.0975 86.5061 39.3991 89.998 39.3991C93.49 39.3991 96.4791 40.0975 98.9654 41.4943C101.452 42.8771 103.358 44.8187 104.685 47.3189C106.012 49.8052 106.676 52.6965 106.676 55.9929C106.676 59.2893 106.012 62.1876 104.685 64.6879C103.358 67.1741 101.452 69.1156 98.9654 70.5124C96.4791 71.8952 93.49 72.5866 89.998 72.5866ZM90.0819 64.0384C91.0596 64.0384 91.9047 63.7101 92.617 63.0536C93.3294 62.3971 93.8811 61.4613 94.2722 60.2461C94.6633 59.0309 94.8588 57.5852 94.8588 55.9091C94.8588 54.219 94.6633 52.7733 94.2722 51.5721C93.8811 50.3569 93.3294 49.421 92.617 48.7646C91.9047 48.1081 91.0596 47.7798 90.0819 47.7798C89.0482 47.7798 88.1613 48.1081 87.421 48.7646C86.6807 49.421 86.115 50.3569 85.7239 51.5721C85.3328 52.7733 85.1373 54.219 85.1373 55.9091C85.1373 57.5852 85.3328 59.0309 85.7239 60.2461C86.115 61.4613 86.6807 62.3971 87.421 63.0536C88.1613 63.7101 89.0482 64.0384 90.0819 64.0384ZM83.3773 36.0469C81.9526 36.0469 80.7444 35.572 79.7527 34.6222C78.7609 33.6723 78.2651 32.527 78.2651 31.1861C78.2651 29.8452 78.7609 28.6998 79.7527 27.75C80.7444 26.8002 81.9526 26.3253 83.3773 26.3253C84.7601 26.3253 85.9404 26.8002 86.9181 27.75C87.9099 28.6998 88.4057 29.8452 88.4057 31.1861C88.4057 32.527 87.9099 33.6723 86.9181 34.6222C85.9404 35.572 84.7601 36.0469 83.3773 36.0469ZM96.7026 36.0469C95.2779 36.0469 94.0697 35.572 93.0779 34.6222C92.0862 33.6723 91.5904 32.527 91.5904 31.1861C91.5904 29.8452 92.0862 28.6998 93.0779 27.75C94.0697 26.8002 95.2779 26.3253 96.7026 26.3253C98.0854 26.3253 99.2657 26.8002 100.243 27.75C101.235 28.6998 101.731 29.8452 101.731 31.1861C101.731 32.527 101.235 33.6723 100.243 34.6222C99.2657 35.572 98.0854 36.0469 96.7026 36.0469ZM122.934 53.8977V72H111.369V39.8182H122.347V45.9361H122.683C123.381 43.8968 124.61 42.2975 126.37 41.1381C128.144 39.9788 130.211 39.3991 132.572 39.3991C134.849 39.3991 136.825 39.9229 138.501 40.9705C140.191 42.0041 141.497 43.4289 142.419 45.2447C143.355 47.0605 143.816 49.1347 143.802 51.4673V72H132.237V53.8977C132.251 52.3054 131.846 51.0553 131.021 50.1474C130.211 49.2395 129.08 48.7855 127.627 48.7855C126.677 48.7855 125.846 48.995 125.134 49.4141C124.436 49.8191 123.898 50.4058 123.521 51.174C123.144 51.9283 122.948 52.8362 122.934 53.8977Z" fill="white"/>
    <path d="M162.74 39.8182H174.306V73.0895C174.306 75.911 173.712 78.1179 172.525 79.7102C171.351 81.3026 169.703 82.427 167.58 83.0835C165.457 83.7399 162.978 84.0682 160.142 84.0682C159.723 84.0682 159.339 84.0612 158.99 84.0472C158.627 84.0333 158.229 84.0123 157.796 83.9844V75.4361C158.075 75.464 158.319 75.485 158.529 75.4989C158.725 75.5129 158.927 75.5199 159.137 75.5199C160.519 75.5199 161.462 75.3034 161.965 74.8704C162.482 74.4513 162.74 73.7739 162.74 72.8381V39.8182ZM168.523 36.4659C166.959 36.4659 165.618 35.9491 164.5 34.9155C163.383 33.8819 162.824 32.6387 162.824 31.1861C162.824 29.7334 163.383 28.4903 164.5 27.4567C165.618 26.4231 166.959 25.9062 168.523 25.9062C170.101 25.9062 171.442 26.4231 172.546 27.4567C173.663 28.4903 174.222 29.7334 174.222 31.1861C174.222 32.6387 173.663 33.8819 172.546 34.9155C171.442 35.9491 170.101 36.4659 168.523 36.4659ZM195.703 72.5866C192.211 72.5866 189.221 71.8952 186.735 70.5124C184.249 69.1156 182.342 67.1741 181.015 64.6879C179.688 62.1876 179.025 59.2893 179.025 55.9929C179.025 52.6965 179.688 49.8052 181.015 47.3189C182.342 44.8187 184.249 42.8771 186.735 41.4943C189.221 40.0975 192.211 39.3991 195.703 39.3991C199.194 39.3991 202.184 40.0975 204.67 41.4943C207.156 42.8771 209.063 44.8187 210.39 47.3189C211.717 49.8052 212.38 52.6965 212.38 55.9929C212.38 59.2893 211.717 62.1876 210.39 64.6879C209.063 67.1741 207.156 69.1156 204.67 70.5124C202.184 71.8952 199.194 72.5866 195.703 72.5866ZM195.786 64.0384C196.764 64.0384 197.609 63.7101 198.322 63.0536C199.034 62.3971 199.586 61.4613 199.977 60.2461C200.368 59.0309 200.563 57.5852 200.563 55.9091C200.563 54.219 200.368 52.7733 199.977 51.5721C199.586 50.3569 199.034 49.421 198.322 48.7646C197.609 48.1081 196.764 47.7798 195.786 47.7798C194.753 47.7798 193.866 48.1081 193.125 48.7646C192.385 49.421 191.819 50.3569 191.428 51.5721C191.037 52.7733 190.842 54.219 190.842 55.9091C190.842 57.5852 191.037 59.0309 191.428 60.2461C191.819 61.4613 192.385 62.3971 193.125 63.0536C193.866 63.7101 194.753 64.0384 195.786 64.0384ZM228.639 53.8977V72H217.073V29.0909H228.22V45.9361H228.555C229.281 43.8828 230.489 42.2835 232.179 41.1381C233.87 39.9788 235.902 39.3991 238.276 39.3991C240.553 39.3991 242.53 39.916 244.206 40.9496C245.896 41.9832 247.202 43.4079 248.124 45.2237C249.06 47.0395 249.52 49.1207 249.507 51.4673V72H237.941V53.8977C237.955 52.3054 237.557 51.0553 236.747 50.1474C235.951 49.2395 234.812 48.7855 233.332 48.7855C232.396 48.7855 231.572 48.995 230.86 49.4141C230.161 49.8191 229.616 50.4058 229.225 51.174C228.848 51.9283 228.653 52.8362 228.639 53.8977ZM274.408 39.8182V48.1989H253.204V39.8182H274.408ZM257.311 32.108H268.876V61.6499C268.876 62.0968 268.953 62.474 269.107 62.7812C269.26 63.0746 269.498 63.2981 269.819 63.4517C270.14 63.5914 270.553 63.6612 271.055 63.6612C271.405 63.6612 271.81 63.6193 272.271 63.5355C272.745 63.4517 273.095 63.3819 273.318 63.326L274.994 71.4553C274.477 71.6089 273.737 71.7975 272.773 72.021C271.824 72.2444 270.692 72.3911 269.379 72.4609C266.725 72.6006 264.497 72.3282 262.696 71.6438C260.894 70.9454 259.539 69.849 258.631 68.3544C257.723 66.8598 257.283 64.9882 257.311 62.7393V32.108ZM294.286 72.5866C290.794 72.5866 287.804 71.8952 285.318 70.5124C282.832 69.1156 280.925 67.1741 279.598 64.6879C278.271 62.1876 277.608 59.2893 277.608 55.9929C277.608 52.6965 278.271 49.8052 279.598 47.3189C280.925 44.8187 282.832 42.8771 285.318 41.4943C287.804 40.0975 290.794 39.3991 294.286 39.3991C297.778 39.3991 300.767 40.0975 303.253 41.4943C305.739 42.8771 307.646 44.8187 308.973 47.3189C310.3 49.8052 310.963 52.6965 310.963 55.9929C310.963 59.2893 310.3 62.1876 308.973 64.6879C307.646 67.1741 305.739 69.1156 303.253 70.5124C300.767 71.8952 297.778 72.5866 294.286 72.5866ZM294.369 64.0384C295.347 64.0384 296.192 63.7101 296.905 63.0536C297.617 62.3971 298.169 61.4613 298.56 60.2461C298.951 59.0309 299.146 57.5852 299.146 55.9091C299.146 54.219 298.951 52.7733 298.56 51.5721C298.169 50.3569 297.617 49.421 296.905 48.7646C296.192 48.1081 295.347 47.7798 294.369 47.7798C293.336 47.7798 292.449 48.1081 291.708 48.7646C290.968 49.421 290.403 50.3569 290.011 51.5721C289.62 52.7733 289.425 54.219 289.425 55.9091C289.425 57.5852 289.62 59.0309 290.011 60.2461C290.403 61.4613 290.968 62.3971 291.708 63.0536C292.449 63.7101 293.336 64.0384 294.369 64.0384Z" fill="#010101"/>
  </svg>
</header>
<div class="container">
       
  
  
  <section class="t_projects">
    <h2>Projektilista</h2>
    <div class="row">
      <ul class="t_projectslist">
        <li class="active" onclick="toggle__tprojects(this);">Kaikki</li>
        <?php
          $projects = mysqli_query($db, "SELECT * FROM `projects`");
          $projects = mysqli_fetch_all($projects);
          $prjct_array = array();
          foreach ($projects as $p) { 
            $hours = mysqli_query($db, "SELECT `h_remaining` FROM `comments` WHERE `projectid`='$p[0]'");
            $hours = mysqli_fetch_all($hours);
            $prjct_summarum = 0;
            foreach ($hours as $h) { 
              $prjct_summarum+=$h[0];
            }
            $prjct_array+= array($p[0] => $pprjct_summarum);
          }
          arsort($prjct_array);
          foreach($prjct_array as $x => $x_value) {
            $pr_name_ = mysqli_query($db, "SELECT * FROM `projects` WHERE `id`='$x' ");
            $_pr_name = mysqli_fetch_all($pr_name_);
            $pr_name = $_pr_name[0][1];
            echo '<li onclick="toggle__tprojects(this,`'.$x.'`);">'.$pr_name.'</li>';
          }    
        ?>
      </ul>
      <a href="/new-project.php" class="start_btn">Aloita uusi projekti</a>
    </div>
    <div class="row">
      <div class="col-6">
        <!-- <h5>Hoitamattomia: <b class="countdown_summarum_undone"></b>h, hoidettuja <b class="countdown_summarum_done"></b>h. <br>Yhteensä <b class="countdown_summarum"></b>h</h5> -->
      </div>
      <div class="col-6">
        <div class="change__work_btn" style="opacity: 0;" onclick="raise__work_modal();">
          Vaihda viikko
        </div>
        <div class="change__worker_btn" style="opacity: 0;" onclick="raise__worker_modal();">
          Vaihda tekijä
        </div>
        <div class="change__pvm_btn" style="opacity: 0;" onclick="raise__pvm_modal();">
          Aseta TARKKA deadline
        </div>
      </div>
    </div>
  </section>
  <section class="t_users">
    <h2>Tekijälista</h2>
    <ul>
      <li class="active" onclick="toggle__tusers(this);">Kaikki</li>
      <?php
       
        $users = mysqli_query($db, "SELECT * FROM `users`");
        $users = mysqli_fetch_all($users);
        $usr_array = array();
            foreach ($users as $p) { 

              

              $hours = mysqli_query($db, "SELECT `h_remaining` FROM `comments` WHERE `comment_to`='$p[1]'");
              $hours = mysqli_fetch_all($hours);
              
              $usr_summarum = 0;
              foreach ($hours as $h) { 
                $usr_summarum+=$h[0];
              }
              $usr_array+= array($p[1] => $usr_summarum);
              // array_push($usr_array, $p[1]=>$usr_summarum);              
            }
            // print_r($usr_array);
            arsort($usr_array);

            foreach($usr_array as $x => $x_value) {
              // echo "Key=" . $x . ", Value=" . $x_value;
              // echo "<br>";
              if(strtolower($x) == "sahko") {
                $photo = '<img src="/img/comroles/light.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($x) == "sahkos") {
                $photo = '<img src="/img/comroles/work.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($x) == "rakennustyo") {
                $photo = '<img src="/img/comroles/work.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($x) == "rakennustyo3") {
                $photo = '<img src="/img/comroles/work.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($x) == "rakennustyo2") {
                $photo = '<img src="/img/comroles/work.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($x) == "ilmastointi") {
                $photo = '<img src="/img/comroles/ventilation.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($x) == "putki_ivs") {
                $photo = '<img src="/img/comroles/ventilation.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($x) == "vesi") {
                $photo = '<img src="/img/comroles/water.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($x) == "vesis") {
                $photo = '<img src="/img/comroles/water.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($x) == "siivous") {
                $photo = '<img src="/img/comroles/siivous.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($x) == "purku") {
                $photo = '<img src="/img/comroles/purku.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($x) == "westface") {
                $photo = '<img src="/img/comroles/wf.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($x) == "myynti") {
                $photo = '<img src="/img/comroles/myynti.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($x) == "lukkomies") {
                $photo = '<img src="/img/comroles/lock.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($x) == "suunnittelu") {
                $photo = '<img src="/img/comroles/suunnittelu.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($x) == "arak") {
                $photo = '<img src="/img/comroles/cup.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($x) == "rak") {
                $photo = '<img src="/img/comroles/cup.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($x) == "pu") {
                $photo = '<img src="/img/comroles/cup.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else {
                $photo = '<img src="/img/comroles/others.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              if($x != "tyonjohto") {
                echo '<li onclick="toggle__tusers(this);">'. $photo.$x.'</li>';
              }
            }
            
      ?>
    </ul>
    <div class="row">
      <div class="col-6">
        <h5>Hoitamattomia: <b class="countdown_summarum_undone"></b>h, hoidettuja <b class="countdown_summarum_done"></b>h. <br>Yhteensä <b class="countdown_summarum"></b>h</h5>
      </div>
      <div class="col-6">
        <div class="change__work_btn" style="opacity: 0;" onclick="raise__work_modal();">
          Vaihda työt
        </div>
      </div>
    </div>
  </section>
  <div class="box late-box">
    <div class="box-header">
      <h3>Myöhässä olevat tiketit <?php $ddate = date("Y-m-d");
          $date = new DateTime($ddate);
          $week = $date->format("W");
          $weekcount = $week;
          $cur_week = $week; ?></h3>
      <h5>Yhteensä työtunteja: <b class="countdown_summarum_late"></b></h5>
      <div class='bar-container'>
        <div class='bar'>
        </div>
      </div>
    </div>
    <div class="box-body" data-week="<?php echo $weekcount ?>" id="late">
      <?php
          

          $bosts = mysqli_query($db, "SELECT * FROM `comments` WHERE `x_y`<$weekcount AND `ending_time`='' AND `answer_to`='' ORDER BY `room` ASC;");
          $bosts = mysqli_fetch_all($bosts);

          foreach ($bosts as $p) {
              $_p = explode("https://", $p[6]);
              $_z = "";
              foreach ($_p as $v) {
                if(strlen($v) >= 7 ) {
                  $_z .= "<li><a href=https://" . $v . " target=`_blank`> <img style='max-width: 200px' src=https://" . $v . " /></a></li>";
                }
              }
              if(strtolower($_GET["user"]) == "tyonjohto") {
                $aloitus_btn ='';
              }
              else {
                $aloitus_btn ='';
              }

              if(strtolower($p[8]) == "sahko") {
                $photo = '<img src="/img/comroles/light.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "sahkos") {
                $photo = '<img src="/img/comroles/work.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "rakennustyo") {
                $photo = '<img src="/img/comroles/work.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "rakennustyo3") {
                $photo = '<img src="/img/comroles/work.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "rakennustyo2") {
                $photo = '<img src="/img/comroles/work.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "ilmastointi") {
                $photo = '<img src="/img/comroles/ventilation.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "putki_ivs") {
                $photo = '<img src="/img/comroles/ventilation.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "vesi") {
                $photo = '<img src="/img/comroles/water.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "vesis") {
                $photo = '<img src="/img/comroles/water.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "siivous") {
                $photo = '<img src="/img/comroles/siivous.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "purku") {
                $photo = '<img src="/img/comroles/purku.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "westface") {
                $photo = '<img src="/img/comroles/wf.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "myynti") {
                $photo = '<img src="/img/comroles/myynti.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "lukkomies") {
                $photo = '<img src="/img/comroles/lock.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "suunnittelu") {
                $photo = '<img src="/img/comroles/suunnittelu.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "arak") {
                $photo = '<img src="/img/comroles/cup.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "rak") {
                $photo = '<img src="/img/comroles/cup.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "pu") {
                $photo = '<img src="/img/comroles/cup.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else {
                $photo = '<img src="/img/comroles/others.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              $comment_id = $p[0];
              $classname =str_replace('a','o',str_replace('Ã','a',str_replace('Ã','a',str_replace('ã','a',str_replace(' <br> ','',str_replace('---','',str_replace('ã','o',str_replace('ä','a',str_replace('--','',str_replace('','',utf8_encode(strtolower($p[2]))))))))))));
            
              if(strtolower($_GET["user"]) == "tyonjohto") {
                $start_btn = '<div class="modal_close_btn drawarea__controls_btn_ aloitus_nappula" onclick="copy_comment(this);">Kopioi</div>';
              }
              else {
                if(strtolower($p[16]) == "aloitettu") {
                  $start_btn = '<div class="modal_close_btn drawarea__controls_btn_ aloitus_nappula" onclick="changestatus(this,`'.$comment_id.'`);">Keskeytä</div>';
                  $border_colour_status = "yellow";
                }
                else if(strtolower($p[16]) == "aloittamatta") {
                  $start_btn = '<div class="modal_close_btn drawarea__controls_btn_ aloitus_nappula" onclick="changestatus(this,`'.$comment_id.'`);">Aloita</div>';
                  $border_colour_status = "black";
                }
                else {
                  $start_btn = '<div class="modal_close_btn drawarea__controls_btn_ aloitus_nappula" onclick="changestatus(this,`'.$comment_id.'`);">Aloita</div>';
                  $border_colour_status = "red";
                }
              }
              if(strtolower($p[16]) == "aloitettu") {
                $border_colour_status = "yellow";
              }
              else if(strtolower($p[16]) == "aloittamatta") {
                $border_colour_status = "black";
              }
              else {
                $border_colour_status = "red";
              }

              

              $_userslist = mysqli_query($db, "SELECT `username` FROM `users`");
              $userslist = mysqli_fetch_all($_userslist);
              

              $ticket_options="";
              
              foreach ($userslist as $usern) {
                if($usern[0] == $p[8]) {
                  $ticket_options.='<option value="'.ucfirst($usern[0]).'" selected>'.ucfirst($usern[0]).'</option>';
                }
                else {
                  $ticket_options.='<option value="'.ucfirst($usern[0]).'">'.ucfirst($usern[0]).'</option>';
                }
              }
              $is_the_critical_checked = '';

              if($p[9] == 'no_critical') {
                $is_the_critical_checked = '';
              }
              else if($p[9] == 'critical') {
                $is_the_critical_checked = 'checked';
              }

              if(strtolower($_GET["user"]) == "tyonjohto") {
                $criticality_option = '
              <div class="row" style="margin-top: 16px;width: 100%;">
                <div class="col-6"><h4>Onko kriitinen?</h4></div>
                <div class="col-6"><input class="commentbox__criticality" type="checkbox" value="Critical" '.$is_the_critical_checked.' min="0" onchange="change_task_criticality(`'.$p[0].'`,this);"/></div>
              </div>';
              }
              else {
                $criticality_option ='';
              }

              $cur_usr = strtolower($_GET["user"]);
              $_curusr = mysqli_query($db, "SELECT * FROM `users` WHERE `username`='$cur_usr';");
              $curusr = mysqli_fetch_all($_curusr);

              if($curusr[0][4] == 1) {
                $usr_option = '
                  <div class="row" style="margin-top: 16px;width: 100%;">
                    <div class="col-6"><h4>Poista kuittaamatta</h4></div>
                    <div class="col-6"><div class="modal_close_btn drawarea__controls_btn sulkemis_nappula" onclick="comment__deletekuittaamatta(this);" name="' . $p[0] . '">Poista kuittaamatta</div></div>
                  </div>';
              }
              else {
                $usr_option ='';
              }

              

              

              
              echo '<article draggable="true"  class="todo-card commentbox ' . $p[0] . ' ' . $p[9] . '" data-room="' . str_replace(' <br>','',str_replace('<br> ','',str_replace(' ','', str_replace('<br>','', $classname)))) . '" data-name="' . $p[0] . '" id="' . $p[0] . '" data-ticket_to="'.$p[8].'" data-project="'.$p[1].'">
              <i class="comment__room">' . explode(">a", $p[2])[0] . '</i>
                <div class="row commentbox__row">
                  <input type="checkbox" data-comid="' . $p[0] . '" name="masselection" class="mass__selection_btn" onchange="changeworkbtn_toggle(`a`);" />
                  <span class="comment_name">' . $p[3] . '<br></span>
                  <span class="comment__status" style="border-color: '.$border_colour_status.'">' . $p[16] . '</span>
                  <span class="comment_who" style="margin-top: -4px;">'.$p[8].'</span>
                  <span class="comment_tta" style="margin-top: -8px;"> ' . $p[18] . '<i> tta</i><br>' . $p[17] . '<i> tja</i></span>
                  <div ontouch="this.parentElement.parentElement.classList.toggle(`open`);" onclick="this.parentElement.parentElement.classList.toggle(`open`);" style="margin-top: -8px;z-index: 999;position: relative;">Avaa/sulje</div>
                </div>
                <div class="row commentbox__secondrow">
                  <div class="col-3">
                    <h4>Tiedostot:</h4>
                    <ul class="commentbox__tiedostot">' . $_z . '</ul>
                  </div>
                  <div class="col-3">
                      <h4>Sisältö:</h4>
                      <p class="commentbox__content" >'. $p[5] . '</p>           
                  </div>
                  <div class="col-3">
                      <h4>Keneltä:</h4>
                      <span class="commentbox__from">' . $p[7] . '</span>
                  </div>
                  <div class="col-3">
                      <h4>Kenelle:</h4>
                      <select class="commentbox__to" onchange="change_task_assignation(`'. $p[0] .'`);">' . $ticket_options .  '</select>
                  </div>
                </div>
                <div class="commentbox__text row commentbox__thirdrow">
                  <div class="col-3">
                      <h4>Myyjän lupaus:</h4>
                      <span class="commentbox__deadline">' . $p[22] . '</span>
                  </div>
                  <div class="col-3">
                      <h4>Deadline:</h4>
                      <span class="commentbox__deadline">' . $p[13] . '</span>
                  </div>
                  <div class="col-3">
                      <h4>TJA:</h4>
                      <span class="commentbox__deadline"><input class="commentbox__date" type="date" value="'.$p[17].'" oninput="change_task_tja(this,`'.$p[0].'`);"/></span>
                  </div>
                  <div class="col-3">
                      <h4>TTA:</h4>
                      <span class="commentbox__deadline">' . $p[18] . '</span>
                  </div>
                </div>
                <div class="row commentbox__fourthrow" style="margin-top: 16px;width: 100%;">  
                  <div class="col-4"><h4>Työtunnit, arvio:</h4><span class="commentbox__hours" type="number">'.$p[15].'h</span></div>
                  <div class="col-4"><h4>Tehdään viikolla:</h4><input class="commentbox__vko" type="number" value="'.$p[4].'" min="'.$cur_week.'" max="52" name="'.$p[0].'" oninput="change_task_vko(this,`'.$p[0].'`);" onchange="change_task_vko(this,`'.$p[0].'`);"/></div>
                  <div class="col-4"><h4>Kuitattu pvm:</h4><span class="commentbox__hours" type="number">'.$p[11].'</span></div>
                </div>';

                $comment_id2 = $p[0]; 
                
                $bosts2 = mysqli_query($db, "SELECT * FROM `comments` WHERE `ending_time`='' AND `answer_to`='$comment_id2' ");
                $bosts2 = mysqli_fetch_all($bosts2);
                
                foreach ($bosts2 as $p2) {
                  $_p2 = explode("https://", $p2[6]);
                  $_z2 = "";
                  foreach ($_p2 as $v2) {
                    if(strlen($v2) >= 7 ) {
                      $_z2 .= "<li><a href=https://" . $v2 . " target=`_blank`> <img style='max-width: 200px' src=https://" . $v2 . " /></a></li>";
                    }
                  }
                  echo '<div class="commentbox commentbox__helpticket ' . $p[0] . ' ' . $p[9] . '" data-room="' . $p[2] . '" data-name="' . $p[0] . '">
                          <h2 class="commentbox__name">' . $p2[3] .'</h2>
                          <div class="row">
                              <div class="col-3">
                                <h4>Tiedostot:</h4>
                                <ul class="commentbox__tiedostot">' . $_z2 .'</ul>
                              </div>
                              <div class="col-3">
                                  <h4>Keneltä:</h4>
                                  <span class="commentbox__from">' . $p2[7] .'</span>
                              </div>
                              <div class="col-3">
                                  <h4>Kenelle:</h4>
                                  <span class="commentbox__to">' . $p2[8] .'</span>
                              </div>
                              <div class="col-3">
                                  <h4>Aihe:</h4>
                                  <span class="commentbox__aihe">' . $p2[12] .'</span>
                              </div>
                              <div class="col-3">
                                  <h4>Deadline:</h4>
                                  <span class="commentbox__deadline">' . $p2[13] .'</span>
                              </div>
                          </div>
                          <div class="commentbox__text">
                              <h4>Sisältö:</h4>
                              <p class="commentbox__content">' . $p2[5] .'</p>
                          </div>
                        </div>';
                }    
                echo '</article>';
            }
                
                
          
      ?>
    </div>
  </div>

  <div class="box in-progress-box">
    <div class="box-header">
      <h3>Tämän viikon hommat <?php $ddate = date("Y-m-d");
          $date = new DateTime($ddate);
          $week = $date->format("W");
          $weekcount = $week;
          $cur_week = $week;
           echo "(#".$week.")"?></h3>
      <h5>Yhteensä työtunteja: <b class="countdown_summarum_a"></b></h5>
      <div class='bar-container'>
        <div class='bar'>
        </div>
      </div>
    </div>
    <div class="box-body" data-week="<?php echo $weekcount ?>" id="a">
      <?php
          

          $bosts = mysqli_query($db, "SELECT * FROM `comments` WHERE `x_y`=$weekcount AND `ending_time`='' AND `answer_to`=''  ORDER BY `room` ASC;");
          $bosts = mysqli_fetch_all($bosts);

          foreach ($bosts as $p) {
              $_p = explode("https://", $p[6]);
              $_z = "";
              foreach ($_p as $v) {
                if(strlen($v) >= 7 ) {
                  $_z .= "<li><a href=https://" . $v . " target=`_blank`> <img style='max-width: 200px' src=https://" . $v . " /></a></li>";
                }
              }
              if(strtolower($_GET["user"]) == "tyonjohto") {
                $aloitus_btn ='';
              }
              else {
                $aloitus_btn ='';
              }

              if(strtolower($p[8]) == "sahko") {
                $photo = '<img src="/img/comroles/light.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "sahkos") {
                $photo = '<img src="/img/comroles/work.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "rakennustyo") {
                $photo = '<img src="/img/comroles/work.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "rakennustyo3") {
                $photo = '<img src="/img/comroles/work.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "rakennustyo2") {
                $photo = '<img src="/img/comroles/work.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "ilmastointi") {
                $photo = '<img src="/img/comroles/ventilation.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "putki_ivs") {
                $photo = '<img src="/img/comroles/ventilation.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "vesi") {
                $photo = '<img src="/img/comroles/water.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "vesis") {
                $photo = '<img src="/img/comroles/water.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "siivous") {
                $photo = '<img src="/img/comroles/siivous.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "purku") {
                $photo = '<img src="/img/comroles/purku.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "westface") {
                $photo = '<img src="/img/comroles/wf.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "myynti") {
                $photo = '<img src="/img/comroles/myynti.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "lukkomies") {
                $photo = '<img src="/img/comroles/lock.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "suunnittelu") {
                $photo = '<img src="/img/comroles/suunnittelu.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "arak") {
                $photo = '<img src="/img/comroles/cup.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "rak") {
                $photo = '<img src="/img/comroles/cup.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else if(strtolower($p[8]) == "pu") {
                $photo = '<img src="/img/comroles/cup.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              else {
                $photo = '<img src="/img/comroles/others.png" style="width:24px; height: 21px;margin-top: -8px;">';
              }
              $comment_id = $p[0];
              $classname =str_replace('a','o',str_replace('Ã','a',str_replace('Ã','a',str_replace('ã','a',str_replace(' <br> ','',str_replace('---','',str_replace('ã','o',str_replace('ä','a',str_replace('--','',str_replace('','',utf8_encode(strtolower($p[2]))))))))))));
            
              if(strtolower($_GET["user"]) == "tyonjohto") {
                $start_btn = '<div class="modal_close_btn drawarea__controls_btn_ aloitus_nappula" onclick="copy_comment(this);">Kopioi</div>';
              }
              else {
                if(strtolower($p[16]) == "aloitettu") {
                  $start_btn = '<div class="modal_close_btn drawarea__controls_btn_ aloitus_nappula" onclick="changestatus(this,`'.$comment_id.'`);">Keskeytä</div>';
                  $border_colour_status = "yellow";
                }
                else if(strtolower($p[16]) == "aloittamatta") {
                  $start_btn = '<div class="modal_close_btn drawarea__controls_btn_ aloitus_nappula" onclick="changestatus(this,`'.$comment_id.'`);">Aloita</div>';
                  $border_colour_status = "black";
                }
                else {
                  $start_btn = '<div class="modal_close_btn drawarea__controls_btn_ aloitus_nappula" onclick="changestatus(this,`'.$comment_id.'`);">Aloita</div>';
                  $border_colour_status = "red";
                }
              }
              if(strtolower($p[16]) == "aloitettu") {
                $border_colour_status = "yellow";
              }
              else if(strtolower($p[16]) == "aloittamatta") {
                $border_colour_status = "black";
              }
              else {
                $border_colour_status = "red";
              }

              

              $_userslist = mysqli_query($db, "SELECT `username` FROM `users`");
              $userslist = mysqli_fetch_all($_userslist);
              

              $ticket_options="";
              
              foreach ($userslist as $usern) {
                if($usern[0] == $p[8]) {
                  $ticket_options.='<option value="'.ucfirst($usern[0]).'" selected>'.ucfirst($usern[0]).'</option>';
                }
                else {
                  $ticket_options.='<option value="'.ucfirst($usern[0]).'">'.ucfirst($usern[0]).'</option>';
                }
              }
              $is_the_critical_checked = '';

              if($p[9] == 'no_critical') {
                $is_the_critical_checked = '';
              }
              else if($p[9] == 'critical') {
                $is_the_critical_checked = 'checked';
              }

              if(strtolower($_GET["user"]) == "tyonjohto") {
                $criticality_option = '
              <div class="row" style="margin-top: 16px;width: 100%;">
                <div class="col-6"><h4>Onko kriitinen?</h4></div>
                <div class="col-6"><input class="commentbox__criticality" type="checkbox" value="Critical" '.$is_the_critical_checked.' min="0" onchange="change_task_criticality(`'.$p[0].'`,this);"/></div>
              </div>';
              }
              else {
                $criticality_option ='';
              }

              $cur_usr = strtolower($_GET["user"]);
              $_curusr = mysqli_query($db, "SELECT * FROM `users` WHERE `username`='$cur_usr';");
              $curusr = mysqli_fetch_all($_curusr);

              if($curusr[0][4] == 1) {
                $usr_option = '
                  <div class="row" style="margin-top: 16px;width: 100%;">
                    <div class="col-6"><h4>Poista kuittaamatta</h4></div>
                    <div class="col-6"><div class="modal_close_btn drawarea__controls_btn sulkemis_nappula" onclick="comment__deletekuittaamatta(this);" name="' . $p[0] . '">Poista kuittaamatta</div></div>
                  </div>';
              }
              else {
                $usr_option ='';
              }

              

              

              
              echo '<article draggable="true"  class="todo-card commentbox ' . $p[0] . ' ' . $p[9] . '" data-room="' . str_replace(' <br>','',str_replace('<br> ','',str_replace(' ','', str_replace('<br>','', $classname)))) . '" data-name="' . $p[0] . '" id="' . $p[0] . '" data-ticket_to="'.$p[8].'" data-project="'.$p[1].'">
              <i class="comment__room">' . explode(">a", $p[2])[0] . '</i>  
              <div class="row commentbox__row">
                  <input type="checkbox" data-comid="' . $p[0] . '" name="masselection" class="mass__selection_btn" onchange="changeworkbtn_toggle(`a`);" />
                  <span class="comment_name">' . $p[3] . '</span>
                  <span class="comment__status" style="border-color: '.$border_colour_status.'">' . $p[16] . '</span>
                  <span class="comment_who" style="margin-top: -4px;">'.$p[8].'</span>
                  <span class="comment_tta" style="margin-top: -8px;"> ' . $p[18] . '<i> tta</i><br>' . $p[17] . '<i> tja</i></span>
                  <div ontouch="this.parentElement.parentElement.classList.toggle(`open`);" onclick="this.parentElement.parentElement.classList.toggle(`open`);" style="margin-top: -8px;z-index: 999;position: relative;">Avaa/sulje</div>
                </div>
                <div class="row commentbox__secondrow">
                  <div class="col-3">
                    <h4>Tiedostot:</h4>
                    <ul class="commentbox__tiedostot">' . $_z . '</ul>
                  </div>
                  <div class="col-3">
                      <h4>Sisältö:</h4>
                      <p class="commentbox__content" >'. $p[5] . '</p>           
                  </div>
                  <div class="col-3">
                      <h4>Keneltä:</h4>
                      <span class="commentbox__from">' . $p[7] . '</span>
                  </div>
                  <div class="col-3">
                      <h4>Kenelle:</h4>
                      <select class="commentbox__to" onchange="change_task_assignation(`'. $p[0] .'`);">' . $ticket_options .  '</select>
                  </div>
                </div>
                <div class="commentbox__text row commentbox__thirdrow">
                  <div class="col-3">
                      <h4>Myyjän lupaus:</h4>
                      <span class="commentbox__deadline">' . $p[22] . '</span>
                  </div>
                  <div class="col-3">
                      <h4>Deadline:</h4>
                      <span class="commentbox__deadline">' . $p[13] . '</span>
                  </div>
                  <div class="col-3">
                      <h4>TJA:</h4>
                      <span class="commentbox__deadline"><input class="commentbox__date" type="date" value="'.$p[17].'" oninput="change_task_tja(this,`'.$p[0].'`);"/></span>
                  </div>
                  <div class="col-3">
                      <h4>TTA:</h4>
                      <span class="commentbox__deadline">' . $p[18] . '</span>
                  </div>
                </div>
                <div class="row commentbox__fourthrow" style="margin-top: 16px;width: 100%;">  
                  <div class="col-4"><h4>Työtunnit, arvio:</h4><span class="commentbox__hours" type="number">'.$p[15].'h</span></div>
                  <div class="col-4"><h4>Tehdään viikolla:</h4><input class="commentbox__vko" type="number" value="'.$p[4].'" min="'.$cur_week.'" max="52" name="'.$p[0].'" oninput="change_task_vko(this,`'.$p[0].'`);" onchange="change_task_vko(this,`'.$p[0].'`);"/></div>
                  <div class="col-4"><h4>Kuitattu pvm:</h4><span class="commentbox__hours" type="number">'.$p[11].'</span></div>
                </div>';

                $comment_id2 = $p[0]; 
                
                $bosts2 = mysqli_query($db, "SELECT * FROM `comments` WHERE `ending_time`='' AND `answer_to`='$comment_id2' ");
                $bosts2 = mysqli_fetch_all($bosts2);
                
                foreach ($bosts2 as $p2) {
                  $_p2 = explode("https://", $p2[6]);
                  $_z2 = "";
                  foreach ($_p2 as $v2) {
                    if(strlen($v2) >= 7 ) {
                      $_z2 .= "<li><a href=https://" . $v2 . " target=`_blank`> <img style='max-width: 200px' src=https://" . $v2 . " /></a></li>";
                    }
                  }
                  echo '<div class="commentbox commentbox__helpticket ' . $p[0] . ' ' . $p[9] . '" data-room="' . $p[2] . '" data-name="' . $p[0] . '">
                          <h2 class="commentbox__name">' . $p2[3] .'</h2>
                          <div class="row">
                              <div class="col-3">
                                <h4>Tiedostot:</h4>
                                <ul class="commentbox__tiedostot">' . $_z2 .'</ul>
                              </div>
                              <div class="col-3">
                                  <h4>Keneltä:</h4>
                                  <span class="commentbox__from">' . $p2[7] .'</span>
                              </div>
                              <div class="col-3">
                                  <h4>Kenelle:</h4>
                                  <span class="commentbox__to">' . $p2[8] .'</span>
                              </div>
                              <div class="col-3">
                                  <h4>Aihe:</h4>
                                  <span class="commentbox__aihe">' . $p2[12] .'</span>
                              </div>
                              <div class="col-3">
                                  <h4>Deadline:</h4>
                                  <span class="commentbox__deadline">' . $p2[13] .'</span>
                              </div>
                          </div>
                          <div class="commentbox__text">
                              <h4>Sisältö:</h4>
                              <p class="commentbox__content">' . $p2[5] .'</p>
                          </div>
                        </div>';
                }    
                echo '</article>';
            }
                
                
          
      ?>
    </div>
  </div>
  <div class="box next-box">
    <div class="box-header">
      <h3><?php 
          $ddate = date("Y-m-d");
          $date = new DateTime($ddate);
          $week = $date->format("W");
          $weekcount = $week+1;
          echo "<b>Viikko #{$weekcount} </b> ";
      ?></h3>
      <h5>Yhteensä työtunteja: <b class="countdown_summarum_b"></b></h5>
    </div>
    <div class="box-body"  data-week="<?php echo $weekcount ?>" id="b">

      <?php
          $ddate = date("Y-m-d");
          $date = new DateTime($ddate);
          $week = $date->format("W");
          $weekcount = $week+1;

          $bosts = mysqli_query($db, "SELECT * FROM `comments` WHERE `x_y`=$weekcount AND `ending_time`='' AND `answer_to`='' ORDER BY `room` ASC;");
          $bosts = mysqli_fetch_all($bosts);

          foreach ($bosts as $p) {
            $_p = explode("https://", $p[6]);
            $_z = "";
            foreach ($_p as $v) {
              if(strlen($v) >= 7 ) {
                $_z .= "<li><a href=https://" . $v . " target=`_blank`> <img style='max-width: 200px' src=https://" . $v . " /></a></li>";
              }
            }
            if(strtolower($_GET["user"]) == "tyonjohto") {
              $aloitus_btn ='';
            }
            else {
              $aloitus_btn ='';
            }

            if(strtolower($p[8]) == "sahko") {
              $photo = '<img src="/img/comroles/light.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "sahkos") {
              $photo = '<img src="/img/comroles/work.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "rakennustyo") {
              $photo = '<img src="/img/comroles/work.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "rakennustyo3") {
              $photo = '<img src="/img/comroles/work.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "rakennustyo2") {
              $photo = '<img src="/img/comroles/work.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "ilmastointi") {
              $photo = '<img src="/img/comroles/ventilation.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "putki_ivs") {
              $photo = '<img src="/img/comroles/ventilation.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "vesi") {
              $photo = '<img src="/img/comroles/water.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "vesis") {
              $photo = '<img src="/img/comroles/water.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "siivous") {
              $photo = '<img src="/img/comroles/siivous.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "purku") {
              $photo = '<img src="/img/comroles/purku.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "westface") {
              $photo = '<img src="/img/comroles/wf.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "myynti") {
              $photo = '<img src="/img/comroles/myynti.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "lukkomies") {
              $photo = '<img src="/img/comroles/lock.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "suunnittelu") {
              $photo = '<img src="/img/comroles/suunnittelu.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "arak") {
              $photo = '<img src="/img/comroles/cup.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "rak") {
              $photo = '<img src="/img/comroles/cup.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "pu") {
              $photo = '<img src="/img/comroles/cup.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else {
              $photo = '<img src="/img/comroles/others.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            $comment_id = $p[0];
            $classname =str_replace('a','o',str_replace('Ã','a',str_replace('Ã','a',str_replace('ã','a',str_replace(' <br> ','',str_replace('---','',str_replace('ã','o',str_replace('ä','a',str_replace('--','',str_replace('','',utf8_encode(strtolower($p[2]))))))))))));
          
            if(strtolower($_GET["user"]) == "tyonjohto") {
              $start_btn = '<div class="modal_close_btn drawarea__controls_btn_ aloitus_nappula" onclick="copy_comment(this);">Kopioi</div>';
            }
            else {
              if(strtolower($p[16]) == "aloitettu") {
                $start_btn = '<div class="modal_close_btn drawarea__controls_btn_ aloitus_nappula" onclick="changestatus(this,`'.$comment_id.'`);">Keskeytä</div>';
                $border_colour_status = "yellow";
              }
              else if(strtolower($p[16]) == "aloittamatta") {
                $start_btn = '<div class="modal_close_btn drawarea__controls_btn_ aloitus_nappula" onclick="changestatus(this,`'.$comment_id.'`);">Aloita</div>';
                $border_colour_status = "black";
              }
              else {
                $start_btn = '<div class="modal_close_btn drawarea__controls_btn_ aloitus_nappula" onclick="changestatus(this,`'.$comment_id.'`);">Aloita</div>';
                $border_colour_status = "red";
              }
            }
            if(strtolower($p[16]) == "aloitettu") {
              $border_colour_status = "yellow";
            }
            else if(strtolower($p[16]) == "aloittamatta") {
              $border_colour_status = "black";
            }
            else {
              $border_colour_status = "red";
            }

            

            $_userslist = mysqli_query($db, "SELECT `username` FROM `users`");
            $userslist = mysqli_fetch_all($_userslist);
            

            $ticket_options="";
            
            foreach ($userslist as $usern) {
              if($usern[0] == $p[8]) {
                $ticket_options.='<option value="'.ucfirst($usern[0]).'" selected>'.ucfirst($usern[0]).'</option>';
              }
              else {
                $ticket_options.='<option value="'.ucfirst($usern[0]).'">'.ucfirst($usern[0]).'</option>';
              }
            }
            $is_the_critical_checked = '';

            if($p[9] == 'no_critical') {
              $is_the_critical_checked = '';
            }
            else if($p[9] == 'critical') {
              $is_the_critical_checked = 'checked';
            }

            if(strtolower($_GET["user"]) == "tyonjohto") {
              $criticality_option = '
            <div class="row" style="margin-top: 16px;width: 100%;">
              <div class="col-6"><h4>Onko kriitinen?</h4></div>
              <div class="col-6"><input class="commentbox__criticality" type="checkbox" value="Critical" '.$is_the_critical_checked.' min="0" onchange="change_task_criticality(`'.$p[0].'`,this);"/></div>
            </div>';
            }
            else {
              $criticality_option ='';
            }

            $cur_usr = strtolower($_GET["user"]);
            $_curusr = mysqli_query($db, "SELECT * FROM `users` WHERE `username`='$cur_usr';");
            $curusr = mysqli_fetch_all($_curusr);

            if($curusr[0][4] == 1) {
              $usr_option = '
                <div class="row" style="margin-top: 16px;width: 100%;">
                  <div class="col-6"><h4>Poista kuittaamatta</h4></div>
                  <div class="col-6"><div class="modal_close_btn drawarea__controls_btn sulkemis_nappula" onclick="comment__deletekuittaamatta(this);" name="' . $p[0] . '">Poista kuittaamatta</div></div>
                </div>';
            }
            else {
              $usr_option ='';
            }

            

            

            
            echo '<article draggable="true"  class="todo-card commentbox ' . $p[0] . ' ' . $p[9] . '" data-room="' . str_replace(' <br>','',str_replace('<br> ','',str_replace(' ','', str_replace('<br>','', $classname)))) . '" data-name="' . $p[0] . '" id="' . $p[0] . '" data-ticket_to="'.$p[8].'" data-project="'.$p[1].'">
            <i class="comment__room">' . explode(">a", $p[2])[0] . '</i>  
            <div class="row commentbox__row">
                  <input type="checkbox" data-comid="' . $p[0] . '" name="masselection" class="mass__selection_btn" onchange="changeworkbtn_toggle(`b`);" />

                <span class="comment_name">' . $p[3] . '</span>
                <span class="comment__status" style="border-color: '.$border_colour_status.'">' . $p[16] . '</span>
                <span class="comment_who" style="margin-top: -4px;">'.$p[8].'</span>
                <span class="comment_tta" style="margin-top: -8px;"> ' . $p[18] . '<i> tta</i><br>' . $p[17] . '<i> tja</i></span>
                <div ontouch="this.parentElement.parentElement.classList.toggle(`open`);" onclick="this.parentElement.parentElement.classList.toggle(`open`);" style="margin-top: -8px;z-index: 999;position: relative;">Avaa/sulje</div>
              </div>
              <div class="row commentbox__secondrow">
                <div class="col-3">
                  <h4>Tiedostot:</h4>
                  <ul class="commentbox__tiedostot">' . $_z . '</ul>
                </div>
                <div class="col-3">
                    <h4>Sisältö:</h4>
                    <p class="commentbox__content" >'. $p[5] . '</p>           
                </div>
                <div class="col-3">
                    <h4>Keneltä:</h4>
                    <span class="commentbox__from">' . $p[7] . '</span>
                </div>
                <div class="col-3">
                    <h4>Kenelle:</h4>
                    <select class="commentbox__to" onchange="change_task_assignation(`'. $p[0] .'`);">' . $ticket_options .  '</select>
                </div>
              </div>
              <div class="commentbox__text row commentbox__thirdrow">
                  <div class="col-3">
                      <h4>Myyjän lupaus:</h4>
                      <span class="commentbox__deadline">' . $p[22] . '</span>
                  </div>
                  <div class="col-3">
                      <h4>Deadline:</h4>
                      <span class="commentbox__deadline">' . $p[13] . '</span>
                  </div>
                  <div class="col-3">
                      <h4>TJA:</h4>
                      <span class="commentbox__deadline"><input class="commentbox__date" type="date" value="'.$p[17].'" oninput="change_task_tja(this,`'.$p[0].'`);"/></span>
                  </div>
                  <div class="col-3">
                      <h4>TTA:</h4>
                      <span class="commentbox__deadline">' . $p[18] . '</span>
                  </div>
                </div>

              <div class="row commentbox__fourthrow" style="margin-top: 16px;width: 100%;">
                <div class="col-4"><h4>Työtunnit, arvio:</h4><span class="commentbox__hours" type="number">'.$p[15].'h</span></div>
                <div class="col-4"><h4>Tehdään viikolla:</h4><input class="commentbox__vko" type="number" value="'.$p[4].'" min="'.$cur_week.'" max="52" name="'.$p[0].'" oninput="change_task_vko(this,`'.$p[0].'`);" onchange="change_task_vko(this,`'.$p[0].'`);"/></div>
                <div class="col-4"><h4>Kuitattu pvm:</h4><span class="commentbox__hours" type="number">'.$p[11].'</span></div>
              </div>';

              $comment_id2 = $p[0]; 
                
                $bosts2 = mysqli_query($db, "SELECT * FROM `comments` WHERE `ending_time`='' AND `answer_to`='$comment_id2'");
                $bosts2 = mysqli_fetch_all($bosts2);
                
                foreach ($bosts2 as $p2) {
                  $_p2 = explode("https://", $p2[6]);
                  $_z2 = "";
                  foreach ($_p2 as $v2) {
                    if(strlen($v2) >= 7 ) {
                      $_z2 .= "<li><a href=https://" . $v2 . " target=`_blank`> <img style='max-width: 200px' src=https://" . $v2 . " /></a></li>";
                    }
                  }
                  echo '<div class="commentbox commentbox__helpticket ' . $p[0] . ' ' . $p[9] . '" data-room="' . $p[2] . '" data-name="' . $p[0] . '">
                          <h2 class="commentbox__name">' . $p2[3] .'</h2>
                          <div class="row">
                              <div class="col-3">
                                <h4>Tiedostot:</h4>
                                <ul class="commentbox__tiedostot">' . $_z2 .'</ul>
                              </div>
                              <div class="col-3">
                                  <h4>Keneltä:</h4>
                                  <span class="commentbox__from">' . $p2[7] .'</span>
                              </div>
                              <div class="col-3">
                                  <h4>Kenelle:</h4>
                                  <span class="commentbox__to">' . $p2[8] .'</span>
                              </div>
                              <div class="col-3">
                                  <h4>Aihe:</h4>
                                  <span class="commentbox__aihe">' . $p2[12] .'</span>
                              </div>
                              <div class="col-3">
                                  <h4>Deadline:</h4>
                                  <span class="commentbox__deadline">' . $p2[13] .'</span>
                              </div>
                          </div>
                          <div class="commentbox__text">
                              <h4>Sisältö:</h4>
                              <p class="commentbox__content">' . $p2[5] .'</p>
                          </div>
                        </div>';
                }    
                echo '</article>';
        }
      ?>
    </div>
  </div>
  
  <div class="box nextnext-box">
    <div class="box-header">
      <h3><?php 
          $ddate = date("Y-m-d");
          $date = new DateTime($ddate);
          $week = $date->format("W");
          $weekcount = $week+2;
          echo "<b>Viikko #{$weekcount} </b> ";
      ?></h3>
      <h5>Yhteensä työtunteja: <b class="countdown_summarum_c"></b></h5>
    </div>

    <div class="box-body"  data-week="<?php echo $weekcount ?>" id="c">
      <?php
          $ddate = date("Y-m-d");
          $date = new DateTime($ddate);
          $week = $date->format("W");
          $weekcount = $week+2;

          $bosts = mysqli_query($db, "SELECT * FROM `comments` WHERE `x_y`=$weekcount AND `ending_time`='' AND `answer_to`='' ORDER BY `room` ASC;");
          $bosts = mysqli_fetch_all($bosts);

          foreach ($bosts as $p) {
            $_p = explode("https://", $p[6]);
            $_z = "";
            foreach ($_p as $v) {
              if(strlen($v) >= 7 ) {
                $_z .= "<li><a href=https://" . $v . " target=`_blank`> <img style='max-width: 200px' src=https://" . $v . " /></a></li>";
              }
            }
            if(strtolower($_GET["user"]) == "tyonjohto") {
              $aloitus_btn ='';
            }
            else {
              $aloitus_btn ='';
            }

            if(strtolower($p[8]) == "sahko") {
              $photo = '<img src="/img/comroles/light.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "sahkos") {
              $photo = '<img src="/img/comroles/work.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "rakennustyo") {
              $photo = '<img src="/img/comroles/work.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "rakennustyo3") {
              $photo = '<img src="/img/comroles/work.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "rakennustyo2") {
              $photo = '<img src="/img/comroles/work.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "ilmastointi") {
              $photo = '<img src="/img/comroles/ventilation.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "putki_ivs") {
              $photo = '<img src="/img/comroles/ventilation.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "vesi") {
              $photo = '<img src="/img/comroles/water.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "vesis") {
              $photo = '<img src="/img/comroles/water.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "siivous") {
              $photo = '<img src="/img/comroles/siivous.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "purku") {
              $photo = '<img src="/img/comroles/purku.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "westface") {
              $photo = '<img src="/img/comroles/wf.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "myynti") {
              $photo = '<img src="/img/comroles/myynti.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "lukkomies") {
              $photo = '<img src="/img/comroles/lock.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "suunnittelu") {
              $photo = '<img src="/img/comroles/suunnittelu.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "arak") {
              $photo = '<img src="/img/comroles/cup.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "rak") {
              $photo = '<img src="/img/comroles/cup.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "pu") {
              $photo = '<img src="/img/comroles/cup.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else {
              $photo = '<img src="/img/comroles/others.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            $comment_id = $p[0];
            $classname =str_replace('a','o',str_replace('Ã','a',str_replace('Ã','a',str_replace('ã','a',str_replace(' <br> ','',str_replace('---','',str_replace('ã','o',str_replace('ä','a',str_replace('--','',str_replace('','',utf8_encode(strtolower($p[2]))))))))))));
          
            if(strtolower($_GET["user"]) == "tyonjohto") {
              $start_btn = '<div class="modal_close_btn drawarea__controls_btn_ aloitus_nappula" onclick="copy_comment(this);">Kopioi</div>';
            }
            else {
              if(strtolower($p[16]) == "aloitettu") {
                $start_btn = '<div class="modal_close_btn drawarea__controls_btn_ aloitus_nappula" onclick="changestatus(this,`'.$comment_id.'`);">Keskeytä</div>';
                $border_colour_status = "yellow";
              }
              else if(strtolower($p[16]) == "aloittamatta") {
                $start_btn = '<div class="modal_close_btn drawarea__controls_btn_ aloitus_nappula" onclick="changestatus(this,`'.$comment_id.'`);">Aloita</div>';
                $border_colour_status = "black";
              }
              else {
                $start_btn = '<div class="modal_close_btn drawarea__controls_btn_ aloitus_nappula" onclick="changestatus(this,`'.$comment_id.'`);">Aloita</div>';
                $border_colour_status = "red";
              }
            }
            if(strtolower($p[16]) == "aloitettu") {
              $border_colour_status = "yellow";
            }
            else if(strtolower($p[16]) == "aloittamatta") {
              $border_colour_status = "black";
            }
            else {
              $border_colour_status = "red";
            }

            

            $_userslist = mysqli_query($db, "SELECT `username` FROM `users`");
            $userslist = mysqli_fetch_all($_userslist);
            

            $ticket_options="";
            
            foreach ($userslist as $usern) {
              if($usern[0] == $p[8]) {
                $ticket_options.='<option value="'.ucfirst($usern[0]).'" selected>'.ucfirst($usern[0]).'</option>';
              }
              else {
                $ticket_options.='<option value="'.ucfirst($usern[0]).'">'.ucfirst($usern[0]).'</option>';
              }
            }
            $is_the_critical_checked = '';

            if($p[9] == 'no_critical') {
              $is_the_critical_checked = '';
            }
            else if($p[9] == 'critical') {
              $is_the_critical_checked = 'checked';
            }

            if(strtolower($_GET["user"]) == "tyonjohto") {
              $criticality_option = '
            <div class="row" style="margin-top: 16px;width: 100%;">
              <div class="col-6"><h4>Onko kriitinen?</h4></div>
              <div class="col-6"><input class="commentbox__criticality" type="checkbox" value="Critical" '.$is_the_critical_checked.' min="0" onchange="change_task_criticality(`'.$p[0].'`,this);"/></div>
            </div>';
            }
            else {
              $criticality_option ='';
            }

            $cur_usr = strtolower($_GET["user"]);
            $_curusr = mysqli_query($db, "SELECT * FROM `users` WHERE `username`='$cur_usr';");
            $curusr = mysqli_fetch_all($_curusr);

            if($curusr[0][4] == 1) {
              $usr_option = '
                <div class="row" style="margin-top: 16px;width: 100%;">
                  <div class="col-6"><h4>Poista kuittaamatta</h4></div>
                  <div class="col-6"><div class="modal_close_btn drawarea__controls_btn sulkemis_nappula" onclick="comment__deletekuittaamatta(this);" name="' . $p[0] . '">Poista kuittaamatta</div></div>
                </div>';
            }
            else {
              $usr_option ='';
            }

            

            

            
            echo '<article draggable="true"  class="todo-card commentbox ' . $p[0] . ' ' . $p[9] . '" data-room="' . str_replace(' <br>','',str_replace('<br> ','',str_replace(' ','', str_replace('<br>','', $classname)))) . '" data-name="' . $p[0] . '" id="' . $p[0] . '" data-ticket_to="'.$p[8].'" data-project="'.$p[1].'">
            <i class="comment__room">' . explode(">a", $p[2])[0] . '</i>  
            <div class="row commentbox__row">
                  <input type="checkbox" data-comid="' . $p[0] . '" name="masselection" class="mass__selection_btn" onchange="changeworkbtn_toggle(`c`);" />

                <span class="comment_name">' . $p[3] . '</span>
                <span class="comment__status" style="border-color: '.$border_colour_status.'">' . $p[16] . '</span>
                <span class="comment_who" style="margin-top: -4px;">'.$p[8].'</span>
                <span class="comment_tta" style="margin-top: -8px;"> ' . $p[18] . '<i> tta</i><br>' . $p[17] . '<i> tja</i></span>
                <div ontouch="this.parentElement.parentElement.classList.toggle(`open`);" onclick="this.parentElement.parentElement.classList.toggle(`open`);" style="margin-top: -8px;z-index: 999;position: relative;">Avaa/sulje</div>
              </div>
              <div class="row commentbox__secondrow">
                <div class="col-3">
                  <h4>Tiedostot:</h4>
                  <ul class="commentbox__tiedostot">' . $_z . '</ul>
                </div>
                <div class="col-3">
                    <h4>Sisältö:</h4>
                    <p class="commentbox__content" >'. $p[5] . '</p>           
                </div>
                <div class="col-3">
                    <h4>Keneltä:</h4>
                    <span class="commentbox__from">' . $p[7] . '</span>
                </div>
                <div class="col-3">
                    <h4>Kenelle:</h4>
                    <select class="commentbox__to" onchange="change_task_assignation(`'. $p[0] .'`);">' . $ticket_options .  '</select>
                </div>
              </div>
              <div class="commentbox__text row commentbox__thirdrow">
                  <div class="col-3">
                      <h4>Myyjän lupaus:</h4>
                      <span class="commentbox__deadline">' . $p[22] . '</span>
                  </div>
                  <div class="col-3">
                      <h4>Deadline:</h4>
                      <span class="commentbox__deadline">' . $p[13] . '</span>
                  </div>
                  <div class="col-3">
                      <h4>TJA:</h4>
                      <span class="commentbox__deadline"><input class="commentbox__date" type="date" value="'.$p[17].'" oninput="change_task_tja(this,`'.$p[0].'`);"/></span>
                  </div>
                  <div class="col-3">
                      <h4>TTA:</h4>
                      <span class="commentbox__deadline">' . $p[18] . '</span>
                  </div>
                </div>

              <div class="row commentbox__fourthrow" style="margin-top: 16px;width: 100%;">
                <div class="col-4"><h4>Työtunnit, arvio:</h4><span class="commentbox__hours" type="number">'.$p[15].'h</span></div>
                <div class="col-4"><h4>Tehdään viikolla:</h4><input class="commentbox__vko" type="number" value="'.$p[4].'" min="'.$cur_week.'" max="52" name="'.$p[0].'" oninput="change_task_vko(this,`'.$p[0].'`);" onchange="change_task_vko(this,`'.$p[0].'`);"/></div>
                <div class="col-4"><h4>Kuitattu pvm:</h4><span class="commentbox__hours" type="number">'.$p[11].'</span></div>
              </div>';

              $comment_id2 = $p[0]; 
                
                $bosts2 = mysqli_query($db, "SELECT * FROM `comments` WHERE `ending_time`='' AND `answer_to`='$comment_id2'");
                $bosts2 = mysqli_fetch_all($bosts2);
                
                foreach ($bosts2 as $p2) {
                  $_p2 = explode("https://", $p2[6]);
                  $_z2 = "";
                  foreach ($_p2 as $v2) {
                    if(strlen($v2) >= 7 ) {
                      $_z2 .= "<li><a href=https://" . $v2 . " target=`_blank`> <img style='max-width: 200px' src=https://" . $v2 . " /></a></li>";
                    }
                  }
                  echo '<div class="commentbox commentbox__helpticket ' . $p[0] . ' ' . $p[9] . '" data-room="' . $p[2] . '" data-name="' . $p[0] . '">
                          <h2 class="commentbox__name">' . $p2[3] .'</h2>
                          <div class="row">
                              <div class="col-3">
                                <h4>Tiedostot:</h4>
                                <ul class="commentbox__tiedostot">' . $_z2 .'</ul>
                              </div>
                              <div class="col-3">
                                  <h4>Keneltä:</h4>
                                  <span class="commentbox__from">' . $p2[7] .'</span>
                              </div>
                              <div class="col-3">
                                  <h4>Kenelle:</h4>
                                  <span class="commentbox__to">' . $p2[8] .'</span>
                              </div>
                              <div class="col-3">
                                  <h4>Aihe:</h4>
                                  <span class="commentbox__aihe">' . $p2[12] .'</span>
                              </div>
                              <div class="col-3">
                                  <h4>Deadline:</h4>
                                  <span class="commentbox__deadline">' . $p2[13] .'</span>
                              </div>
                          </div>
                          <div class="commentbox__text">
                              <h4>Sisältö:</h4>
                              <p class="commentbox__content">' . $p2[5] .'</p>
                          </div>
                        </div>';
                }    
                echo '</article>';
        }
      ?>
    </div>
    
  </div>

  <div class="box others-box">
    <div class="box-header">
      <h3>Loput</h3>
      <h5>Yhteensä työtunteja: <b class="countdown_summarum_e"></b></h5>
    </div>

    <div class="box-body"  data-week="<?php echo $weekcount ?>" id="loput">
      <?php
          $ddate = date("Y-m-d");
          $date = new DateTime($ddate);
          $week = $date->format("W");
          $weekcount = $week+1;

          $bosts = mysqli_query($db, "SELECT * FROM `comments` WHERE `x_y`>$week+2 AND `ending_time`=''  AND `answer_to`='' ORDER BY `room` ASC;");
          $bosts = mysqli_fetch_all($bosts);

          foreach ($bosts as $p) {
            $_p = explode("https://", $p[6]);
            $_z = "";
            foreach ($_p as $v) {
              if(strlen($v) >= 7 ) {
                $_z .= "<li><a href=https://" . $v . " target=`_blank`> <img style='max-width: 200px' src=https://" . $v . " /></a></li>";
              }
            }
            if(strtolower($_GET["user"]) == "tyonjohto") {
              $aloitus_btn ='';
            }
            else {
              $aloitus_btn ='';
            }

            if(strtolower($p[8]) == "sahko") {
              $photo = '<img src="/img/comroles/light.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "sahkos") {
              $photo = '<img src="/img/comroles/work.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "rakennustyo") {
              $photo = '<img src="/img/comroles/work.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "rakennustyo3") {
              $photo = '<img src="/img/comroles/work.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "rakennustyo2") {
              $photo = '<img src="/img/comroles/work.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "ilmastointi") {
              $photo = '<img src="/img/comroles/ventilation.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "putki_ivs") {
              $photo = '<img src="/img/comroles/ventilation.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "vesi") {
              $photo = '<img src="/img/comroles/water.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "vesis") {
              $photo = '<img src="/img/comroles/water.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "siivous") {
              $photo = '<img src="/img/comroles/siivous.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "purku") {
              $photo = '<img src="/img/comroles/purku.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "westface") {
              $photo = '<img src="/img/comroles/wf.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "myynti") {
              $photo = '<img src="/img/comroles/myynti.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "lukkomies") {
              $photo = '<img src="/img/comroles/lock.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "suunnittelu") {
              $photo = '<img src="/img/comroles/suunnittelu.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "arak") {
              $photo = '<img src="/img/comroles/cup.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "rak") {
              $photo = '<img src="/img/comroles/cup.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "pu") {
              $photo = '<img src="/img/comroles/cup.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else {
              $photo = '<img src="/img/comroles/others.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            $comment_id = $p[0];
            $classname =str_replace('a','o',str_replace('Ã','a',str_replace('Ã','a',str_replace('ã','a',str_replace(' <br> ','',str_replace('---','',str_replace('ã','o',str_replace('ä','a',str_replace('--','',str_replace('','',utf8_encode(strtolower($p[2]))))))))))));
          
            if(strtolower($_GET["user"]) == "tyonjohto") {
              $start_btn = '<div class="modal_close_btn drawarea__controls_btn_ aloitus_nappula" onclick="copy_comment(this);">Kopioi</div>';
            }
            else {
              if(strtolower($p[16]) == "aloitettu") {
                $start_btn = '<div class="modal_close_btn drawarea__controls_btn_ aloitus_nappula" onclick="changestatus(this,`'.$comment_id.'`);">Keskeytä</div>';
                $border_colour_status = "yellow";
              }
              else if(strtolower($p[16]) == "aloittamatta") {
                $start_btn = '<div class="modal_close_btn drawarea__controls_btn_ aloitus_nappula" onclick="changestatus(this,`'.$comment_id.'`);">Aloita</div>';
                $border_colour_status = "black";
              }
              else {
                $start_btn = '<div class="modal_close_btn drawarea__controls_btn_ aloitus_nappula" onclick="changestatus(this,`'.$comment_id.'`);">Aloita</div>';
                $border_colour_status = "red";
              }
            }
            if(strtolower($p[16]) == "aloitettu") {
              $border_colour_status = "yellow";
            }
            else if(strtolower($p[16]) == "aloittamatta") {
              $border_colour_status = "black";
            }
            else {
              $border_colour_status = "red";
            }

            

            $_userslist = mysqli_query($db, "SELECT `username` FROM `users`");
            $userslist = mysqli_fetch_all($_userslist);
            

            $ticket_options="";
            
            foreach ($userslist as $usern) {
              if($usern[0] == $p[8]) {
                $ticket_options.='<option value="'.ucfirst($usern[0]).'" selected>'.ucfirst($usern[0]).'</option>';
              }
              else {
                $ticket_options.='<option value="'.ucfirst($usern[0]).'">'.ucfirst($usern[0]).'</option>';
              }
            }
            $is_the_critical_checked = '';

            if($p[9] == 'no_critical') {
              $is_the_critical_checked = '';
            }
            else if($p[9] == 'critical') {
              $is_the_critical_checked = 'checked';
            }

            if(strtolower($_GET["user"]) == "tyonjohto") {
              $criticality_option = '
            <div class="row" style="margin-top: 16px;width: 100%;">
              <div class="col-6"><h4>Onko kriitinen?</h4></div>
              <div class="col-6"><input class="commentbox__criticality" type="checkbox" value="Critical" '.$is_the_critical_checked.' min="0" onchange="change_task_criticality(`'.$p[0].'`,this);"/></div>
            </div>';
            }
            else {
              $criticality_option ='';
            }

            $cur_usr = strtolower($_GET["user"]);
            $_curusr = mysqli_query($db, "SELECT * FROM `users` WHERE `username`='$cur_usr';");
            $curusr = mysqli_fetch_all($_curusr);

            if($curusr[0][4] == 1) {
              $usr_option = '
                <div class="row" style="margin-top: 16px;width: 100%;">
                  <div class="col-6"><h4>Poista kuittaamatta</h4></div>
                  <div class="col-6"><div class="modal_close_btn drawarea__controls_btn sulkemis_nappula" onclick="comment__deletekuittaamatta(this);" name="' . $p[0] . '">Poista kuittaamatta</div></div>
                </div>';
            }
            else {
              $usr_option ='';
            }

            

            

            
            echo '<article draggable="true"  class="todo-card commentbox ' . $p[0] . ' ' . $p[9] . '" data-room="' . str_replace(' <br>','',str_replace('<br> ','',str_replace(' ','', str_replace('<br>','', $classname)))) . '" data-name="' . $p[0] . '" id="' . $p[0] . '" data-ticket_to="'.$p[8].'" data-project="'.$p[1].'">
            <i class="comment__room">' . explode(">a", $p[2])[0] . '</i>
            <div class="row commentbox__row">
                  <input type="checkbox" data-comid="' . $p[0] . '" name="masselection" class="mass__selection_btn" onchange="changeworkbtn_toggle(`loput`);" />

                <span class="comment_name">' . $p[3] . '</span>
                <span class="comment__status" style="border-color: '.$border_colour_status.'">' . $p[16] . '</span>
                <span class="comment_who" style="margin-top: -4px;">'.$p[8].'</span>
                <span class="comment_tta" style="margin-top: -8px;"> ' . $p[18] . '<i> tta</i><br>' . $p[17] . '<i> tja</i></span>
                <div ontouch="this.parentElement.parentElement.classList.toggle(`open`);" onclick="this.parentElement.parentElement.classList.toggle(`open`);" style="margin-top: -8px;z-index: 999;position: relative;">Avaa/sulje</div>
              </div>
              <div class="row commentbox__secondrow">
                <div class="col-3">
                  <h4>Tiedostot:</h4>
                  <ul class="commentbox__tiedostot">' . $_z . '</ul>
                </div>
                <div class="col-3">
                    <h4>Sisältö:</h4>
                    <p class="commentbox__content" >'. $p[5] . '</p>           
                </div>
                <div class="col-3">
                    <h4>Keneltä:</h4>
                    <span class="commentbox__from">' . $p[7] . '</span>
                </div>
                <div class="col-3">
                    <h4>Kenelle:</h4>
                    <select class="commentbox__to" onchange="change_task_assignation(`'. $p[0] .'`);">' . $ticket_options .  '</select>
                </div>
              </div>
              <div class="commentbox__text row commentbox__thirdrow">
                  <div class="col-3">
                      <h4>Myyjän lupaus:</h4>
                      <span class="commentbox__deadline">' . $p[22] . '</span>
                  </div>
                  <div class="col-3">
                      <h4>Deadline:</h4>
                      <span class="commentbox__deadline">' . $p[13] . '</span>
                  </div>
                  <div class="col-3">
                      <h4>TJA:</h4>
                      <span class="commentbox__deadline"><input class="commentbox__date" type="date" value="'.$p[17].'" oninput="change_task_tja(this,`'.$p[0].'`);"/></span>
                  </div>
                  <div class="col-3">
                      <h4>TTA:</h4>
                      <span class="commentbox__deadline">' . $p[18] . '</span>
                  </div>
                </div>

              <div class="row commentbox__fourthrow" style="margin-top: 16px;width: 100%;">
                <div class="col-4"><h4>Työtunnit, arvio:</h4><span class="commentbox__hours" type="number">'.$p[15].'h</span></div>
                <div class="col-4"><h4>Tehdään viikolla:</h4><input class="commentbox__vko" type="number" value="'.$p[4].'" min="'.$cur_week.'" max="52" name="'.$p[0].'" oninput="change_task_vko(this,`'.$p[0].'`);" onchange="change_task_vko(this,`'.$p[0].'`);"/></div>
                <div class="col-4"><h4>Kuitattu pvm:</h4><span class="commentbox__hours" type="number">'.$p[11].'</span></div>
              </div>';
              $comment_id2 = $p[0]; 
                
                $bosts2 = mysqli_query($db, "SELECT * FROM `comments` WHERE `ending_time`='' AND `answer_to`='$comment_id2'");
                $bosts2 = mysqli_fetch_all($bosts2);
                
                foreach ($bosts2 as $p2) {
                  $_p2 = explode("https://", $p2[6]);
                  $_z2 = "";
                  foreach ($_p2 as $v2) {
                    if(strlen($v2) >= 7 ) {
                      $_z2 .= "<li><a href=https://" . $v2 . " target=`_blank`> <img style='max-width: 200px' src=https://" . $v2 . " /></a></li>";
                    }
                  }
                  echo '<div class="commentbox commentbox__helpticket ' . $p[0] . ' ' . $p[9] . '" data-room="' . $p[2] . '" data-name="' . $p[0] . '">
                          <h2 class="commentbox__name">' . $p2[3] .'</h2>
                          <div class="row">
                              <div class="col-3">
                                <h4>Tiedostot:</h4>
                                <ul class="commentbox__tiedostot">' . $_z2 .'</ul>
                              </div>
                              <div class="col-3">
                                  <h4>Keneltä:</h4>
                                  <span class="commentbox__from">' . $p2[7] .'</span>
                              </div>
                              <div class="col-3">
                                  <h4>Kenelle:</h4>
                                  <span class="commentbox__to">' . $p2[8] .'</span>
                              </div>
                              <div class="col-3">
                                  <h4>Aihe:</h4>
                                  <span class="commentbox__aihe">' . $p2[12] .'</span>
                              </div>
                              <div class="col-3">
                                  <h4>Deadline:</h4>
                                  <span class="commentbox__deadline">' . $p2[13] .'</span>
                              </div>
                          </div>
                          <div class="commentbox__text">
                              <h4>Sisältö:</h4>
                              <p class="commentbox__content">' . $p2[5] .'</p>
                          </div>
                        </div>';
                }    
                echo '</article>';
        }
      ?>
    </div>
    
  </div>

  <div class="box done-box">
    <div class="box-header">
      <h3>Valmiit työt (tarkistettava)</h3>
      <h5>Yhteensä työtunteja: <b class="countdown_summarum_d"></b></h5>
    </div>

    <div class="box-body" id="valmiit">
      <?php
          $ddate = date("Y-m-d");
          $date = new DateTime($ddate);
          $week = $date->format("W");
          $weekcount = $week+2;

          $bosts = mysqli_query($db, "SELECT * FROM `comments` WHERE `ending_time` != '' AND `status` != 'ok'  AND `answer_to`='' ORDER BY `room` ASC;");
          $bosts = mysqli_fetch_all($bosts);

          foreach ($bosts as $p) {
            $_p = explode("https://", $p[6]);
            $_z = "";
            foreach ($_p as $v) {
              if(strlen($v) >= 7 ) {
                $_z .= "<li><a href=https://" . $v . " target=`_blank`> <img style='max-width: 200px' src=https://" . $v . " /></a></li>";
              }
            }
            if(strtolower($_GET["user"]) == "tyonjohto") {
              $aloitus_btn ='';
            }
            else {
              $aloitus_btn ='';
            }

            if(strtolower($p[8]) == "sahko") {
              $photo = '<img src="/img/comroles/light.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "sahkos") {
              $photo = '<img src="/img/comroles/work.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "rakennustyo") {
              $photo = '<img src="/img/comroles/work.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "rakennustyo3") {
              $photo = '<img src="/img/comroles/work.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "rakennustyo2") {
              $photo = '<img src="/img/comroles/work.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "ilmastointi") {
              $photo = '<img src="/img/comroles/ventilation.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "putki_ivs") {
              $photo = '<img src="/img/comroles/ventilation.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "vesi") {
              $photo = '<img src="/img/comroles/water.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "vesis") {
              $photo = '<img src="/img/comroles/water.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "siivous") {
              $photo = '<img src="/img/comroles/siivous.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "purku") {
              $photo = '<img src="/img/comroles/purku.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "westface") {
              $photo = '<img src="/img/comroles/wf.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "myynti") {
              $photo = '<img src="/img/comroles/myynti.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "lukkomies") {
              $photo = '<img src="/img/comroles/lock.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "suunnittelu") {
              $photo = '<img src="/img/comroles/suunnittelu.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "arak") {
              $photo = '<img src="/img/comroles/cup.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "rak") {
              $photo = '<img src="/img/comroles/cup.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else if(strtolower($p[8]) == "pu") {
              $photo = '<img src="/img/comroles/cup.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            else {
              $photo = '<img src="/img/comroles/others.png" style="width:24px; height: 21px;margin-top: -8px;">';
            }
            $comment_id = $p[0];
            $classname =str_replace('a','o',str_replace('Ã','a',str_replace('Ã','a',str_replace('ã','a',str_replace(' <br> ','',str_replace('---','',str_replace('ã','o',str_replace('ä','a',str_replace('--','',str_replace('','',utf8_encode(strtolower($p[2]))))))))))));
          
            if(strtolower($_GET["user"]) == "tyonjohto") {
              $start_btn = '<div class="modal_close_btn drawarea__controls_btn_ aloitus_nappula" onclick="copy_comment(this);">Kopioi</div>';
            }
            else {
              if(strtolower($p[16]) == "aloitettu") {
                $start_btn = '<div class="modal_close_btn drawarea__controls_btn_ aloitus_nappula" onclick="changestatus(this,`'.$comment_id.'`);">Keskeytä</div>';
                $border_colour_status = "yellow";
              }
              else if(strtolower($p[16]) == "aloittamatta") {
                $start_btn = '<div class="modal_close_btn drawarea__controls_btn_ aloitus_nappula" onclick="changestatus(this,`'.$comment_id.'`);">Aloita</div>';
                $border_colour_status = "black";
              }
              else {
                $start_btn = '<div class="modal_close_btn drawarea__controls_btn_ aloitus_nappula" onclick="changestatus(this,`'.$comment_id.'`);">Aloita</div>';
                $border_colour_status = "red";
              }
            }
            if(strtolower($p[16]) == "aloitettu") {
              $border_colour_status = "yellow";
            }
            else if(strtolower($p[16]) == "aloittamatta") {
              $border_colour_status = "black";
            }
            else {
              $border_colour_status = "red";
            }

            

            $_userslist = mysqli_query($db, "SELECT `username` FROM `users`");
            $userslist = mysqli_fetch_all($_userslist);
            

            $ticket_options="";
            
            foreach ($userslist as $usern) {
              if($usern[0] == $p[8]) {
                $ticket_options.='<option value="'.ucfirst($usern[0]).'" selected>'.ucfirst($usern[0]).'</option>';
              }
              else {
                $ticket_options.='<option value="'.ucfirst($usern[0]).'">'.ucfirst($usern[0]).'</option>';
              }
            }
            $is_the_critical_checked = '';

            if($p[9] == 'no_critical') {
              $is_the_critical_checked = '';
            }
            else if($p[9] == 'critical') {
              $is_the_critical_checked = 'checked';
            }

            if(strtolower($_GET["user"]) == "tyonjohto") {
              $criticality_option = '
            <div class="row" style="margin-top: 16px;width: 100%;">
              <div class="col-6"><h4>Onko kriitinen?</h4></div>
              <div class="col-6"><input class="commentbox__criticality" type="checkbox" value="Critical" '.$is_the_critical_checked.' min="0" onchange="change_task_criticality(`'.$p[0].'`,this);"/></div>
            </div>';
            }
            else {
              $criticality_option ='';
            }

            $cur_usr = strtolower($_GET["user"]);
            $_curusr = mysqli_query($db, "SELECT * FROM `users` WHERE `username`='$cur_usr';");
            $curusr = mysqli_fetch_all($_curusr);

            if($curusr[0][4] == 1) {
              $usr_option = '
                <div class="row" style="margin-top: 16px;width: 100%;">
                  <div class="col-6"><h4>Poista kuittaamatta</h4></div>
                  <div class="col-6"><div class="modal_close_btn drawarea__controls_btn sulkemis_nappula" onclick="comment__deletekuittaamatta(this);" name="' . $p[0] . '">Poista kuittaamatta</div></div>
                </div>';
            }
            else {
              $usr_option ='';
            }

            

            

            
            echo '<article draggable="true"  class="todo-card commentbox ' . $p[0] . ' ' . $p[9] . '" data-room="' . str_replace(' <br>','',str_replace('<br> ','',str_replace(' ','', str_replace('<br>','', $classname)))) . '" data-name="' . $p[0] . '" id="' . $p[0] . '" data-ticket_to="'.$p[8].'" data-project="'.$p[1].'">
             <i class="comment__room">' . explode(">a", $p[2])[0] . '</i>  
              <div class="row commentbox__row">
                  <input type="checkbox" data-comid="' . $p[0] . '" name="masselection" class="mass__selection_btn" onchange="changeworkbtn_toggle(`valmiit`);"/>

                <span class="comment_name">' . $p[3] . '</span>
                <span class="comment__status" style="border-color: '.$border_colour_status.'">' . $p[16] . '</span>
                <span class="comment_who" style="margin-top: -4px;">'.$p[8].'</span>
                <span class="comment_tta" style="margin-top: -8px;"> ' . $p[18] . '<i> tta</i><br>' . $p[17] . '<i> tja</i></span>
                <div ontouch="this.parentElement.parentElement.classList.toggle(`open`);" onclick="this.parentElement.parentElement.classList.toggle(`open`);" style="margin-top: -8px;z-index: 999;position: relative;">Avaa/sulje</div>
              </div>
              <div class="row commentbox__secondrow">
                <div class="col-3">
                  <h4>Tiedostot:</h4>
                  <ul class="commentbox__tiedostot">' . $_z . '</ul>
                </div>
                <div class="col-3">
                    <h4>Sisältö:</h4>
                    <p class="commentbox__content" >'. $p[5] . '</p>           
                </div>
                <div class="col-3">
                    <h4>Keneltä:</h4>
                    <span class="commentbox__from">' . $p[7] . '</span>
                </div>
                <div class="col-3">
                    <h4>Kenelle:</h4>
                    <select class="commentbox__to" onchange="change_task_assignation(`'. $p[0] .'`);">' . $ticket_options .  '</select>
                </div>
              </div>
              <div class="commentbox__text row commentbox__thirdrow">
                  <div class="col-3">
                      <h4>Myyjän lupaus:</h4>
                      <span class="commentbox__deadline">' . $p[22] . '</span>
                  </div>
                  <div class="col-3">
                      <h4>Deadline:</h4>
                      <span class="commentbox__deadline">' . $p[13] . '</span>
                  </div>
                  <div class="col-3">
                      <h4>TJA:</h4>
                      <span class="commentbox__deadline"><input class="commentbox__date" type="date" value="'.$p[17].'" oninput="change_task_tja(this,`'.$p[0].'`);"/></span>
                  </div>
                  <div class="col-3">
                      <h4>TTA:</h4>
                      <span class="commentbox__deadline">' . $p[18] . '</span>
                  </div>
                </div>

              <div class="row commentbox__fourthrow" style="margin-top: 16px;width: 100%;">
                <div class="col-4"><h4>Työtunnit, arvio:</h4><span class="commentbox__hours" type="number">'.$p[15].'h</span></div>
                <div class="col-4"><h4>Tehdään viikolla:</h4><input class="commentbox__vko" type="number" value="'.$p[4].'" min="'.$cur_week.'" max="52" name="'.$p[0].'" oninput="change_task_vko(this,`'.$p[0].'`);" onchange="change_task_vko(this,`'.$p[0].'`);"/></div>
                <div class="col-4"><h4>Kuitattu pvm:</h4><span class="commentbox__hours" type="number">'.$p[11].'</span></div>
              </div>
              
              <div class="row commentbox__fifthrow" style="margin-top: 16px;width: 100%;">
                <div class="col-6 badwork_btn btn" onclick="modify__ticketapproval(this);">Hylkää</div>
                <div class="col-6 goodwork_btn btn" onclick="modify__ticketapproval(this);">Hyväksy</div>
              </div>';

              $comment_id2 = $p[0]; 
                
              $bosts2 = mysqli_query($db, "SELECT * FROM `comments` WHERE `ending_time`='' AND `answer_to`='$comment_id2'");
              $bosts2 = mysqli_fetch_all($bosts2);
              
              foreach ($bosts2 as $p2) {
                $_p2 = explode("https://", $p2[6]);
                $_z2 = "";
                foreach ($_p2 as $v2) {
                  if(strlen($v2) >= 7 ) {
                    $_z2 .= "<li><a href=https://" . $v2 . " target=`_blank`> <img style='max-width: 200px' src=https://" . $v2 . " /></a></li>";
                  }
                }
                echo '<div class="commentbox commentbox__helpticket ' . $p[0] . ' ' . $p[9] . '" data-room="' . $p[2] . '" data-name="' . $p[0] . '">
                        <h2 class="commentbox__name">' . $p2[3] .'</h2>
                        <div class="row">
                            <div class="col-3">
                              <h4>Tiedostot:</h4>
                              <ul class="commentbox__tiedostot">' . $_z2 .'</ul>
                            </div>
                            <div class="col-3">
                                <h4>Keneltä:</h4>
                                <span class="commentbox__from">' . $p2[7] .'</span>
                            </div>
                            <div class="col-3">
                                <h4>Kenelle:</h4>
                                <span class="commentbox__to">' . $p2[8] .'</span>
                            </div>
                            <div class="col-3">
                                <h4>Aihe:</h4>
                                <span class="commentbox__aihe">' . $p2[12] .'</span>
                            </div>
                            <div class="col-3">
                                <h4>Deadline:</h4>
                                <span class="commentbox__deadline">' . $p2[13] .'</span>
                            </div>
                        </div>
                        <div class="commentbox__text">
                            <h4>Sisältö:</h4>
                            <p class="commentbox__content">' . $p2[5] .'</p>
                        </div>
                      </div>';
              }    
              echo '</article>';
        }
      ?>
    </div>
    
  </div>

  <div class="row" style="justify-content: space-between">
    <div class="yellowbtn" onclick="save_to_db();">Lähetä työt perjantaiaamulla</div>
    <div class="start_btn"  onclick="send_work();">Lähetä työt välittömästi</div>
  </div>
  

</div>
<div class="first_popup cus-container">
  <div class="modal-background">
    <div class="modal">
      <div class="modal_close_btn" onclick="document.querySelector('.first_popup').classList.add('out');document.querySelector('.first_popup').classList.remove('two');">
      <b><svg width="20" height="18" viewBox="0 0 20 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 1.87367L17.9857 0.0703049L10 7.21983L2.01429 0.0703049L0 1.87367L7.98572 9.0232L0 16.1727L2.01429 17.9761L10 10.8266L17.9857 17.9761L20 16.1727L12.0143 9.0232L20 1.87367Z" fill="#444444"/></svg></b></div>
      <h3>Siirrä kohteeseen:</h3>
      
      <fieldset>
        <input name="weekselection" type="radio" class="weekselection a" id="weekselection_1" data-currentwk="<?php echo (intval($week)+1) ?>" data-to="a">
        <label for="weekselection_1">Viikko <?php echo "#" . intval($week) ?></label>

        <input name="weekselection" type="radio" class="weekselection b" id="weekselection_2" data-currentwk="<?php echo (intval($week)+1) ?>" data-to="b">
        <label for="weekselection_2">Viikko <?php echo "#" . (intval($week)+1) ?></label>

        <input name="weekselection" type="radio" class="weekselection c" id="weekselection_3" data-currentwk="<?php echo (intval($week)+1) ?>" data-to="c">
        <label for="weekselection_3">Viikko <?php echo "#" . (intval($week)+2) ?></label>

        <!-- <input name="weekselection" type="radio" class="weekselection loput" id="weekselection_4" data-to="loput">
        <label for="weekselection_4">Loput</label>

        <input name="weekselection" type="radio" class="weekselection valmiit" id="weekselection_5" data-to="valmiit">
        <label for="weekselection_5">Valmiit työt</label> -->

      </fieldset>
      <div class="modal_close_btn drawarea__controls_btn btn ready_btn" onclick="document.querySelector('.first_popup').classList.add('out');document.querySelector('.first_popup').classList.remove('two');change__tickets_direction();" style="text-align: center; width: 100%;">Valmis</div>
    </div>
  </div>
</div>

<div class="second_popup cus-container">
  <div class="modal-background">
    <div class="modal">
      <div class="modal_close_btn" onclick="document.querySelector('.second_popup').classList.add('out');document.querySelector('.second_popup').classList.remove('two');">
      <b><svg width="20" height="18" viewBox="0 0 20 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 1.87367L17.9857 0.0703049L10 7.21983L2.01429 0.0703049L0 1.87367L7.98572 9.0232L0 16.1727L2.01429 17.9761L10 10.8266L17.9857 17.9761L20 16.1727L12.0143 9.0232L20 1.87367Z" fill="#444444"/></svg></b></div>
      <h3>Valitse tekijä:</h3>
      <div class="row">

      
        <div class="col-6">
          <h6>Kenelle:</h6>
        </div>
        <div class="col-6">
          <?php
            $_userslist = mysqli_query($db, "SELECT `username` FROM `users`");
            $userslist = mysqli_fetch_all($_userslist);
            $ul="";
            foreach ($userslist as $usern) {
              $ul.='<option value="'.ucfirst($usern[0]).'">'.ucfirst($usern[0]).'</option>';
            }
            echo '<select name="kommentti_comment_to" class="kommentti_comment_to kommentti_comment_newto" multiple>'.$ul.'</select>';
          ?>
        </div>
      </div>
      
      <div class="modal_close_btn drawarea__controls_btn btn ready_btn" onclick="document.querySelector('.second_popup').classList.add('out');document.querySelector('.second_popup').classList.remove('two');change__tickets_receipent();" style="text-align: center; width: 100%;">Valmis</div>
    </div>
  </div>
</div>
<div class="third_popup cus-container">
  <div class="modal-background">
    <div class="modal">
      <div class="modal_close_btn" onclick="document.querySelector('.third_popup').classList.add('out');document.querySelector('.third_popup').classList.remove('two');">
      <b><svg width="20" height="18" viewBox="0 0 20 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 1.87367L17.9857 0.0703049L10 7.21983L2.01429 0.0703049L0 1.87367L7.98572 9.0232L0 16.1727L2.01429 17.9761L10 10.8266L17.9857 17.9761L20 16.1727L12.0143 9.0232L20 1.87367Z" fill="#444444"/></svg></b></div>
      <h3>Vaihda päivämäärä:</h3>
      <div class="row">
        <div class="col-6">
          <h6>Deadline:</h6>
          <input name="deadline_time" class="comment__deadline" type="date" min="<?= date("Y-m-d") ?>" value="<?= date("Y-m-t", strtotime(date("Y-m-d"))) ?>" onchange="document.querySelector('#newcomment__vko').value = new Date(this.value).getWeek();" id="newcomment__deadline">
        </div>
        <div class="col-6" style="">     
          <h6>Tehdään viikolla</h6>
          <input name="vko_estimate" class="vko_estimate" type="number" value="1" min="1" max="52" style="max-width: 70px;" id="newcomment__vko">
        </div>
      </div>
      
      <div class="modal_close_btn drawarea__controls_btn btn ready_btn" onclick="document.querySelector('.third_popup').classList.add('out');document.querySelector('.third_popup').classList.remove('two');change__tickets_pvm();" style="text-align: center; width: 100%;">Valmis</div>
    </div>
  </div>
</div>
<script src='/js/jquery.min.js'></script>
<script src="./sortablejs.min.js"></script>
<script src="./script.js"></script>

</body>

</html>